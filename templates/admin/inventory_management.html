<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='CSS/style.css') }}"
        media="screen and (min-width:481px)">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='CSS/mobileStyle.css') }}"
        media="screen and (max-width:480px)">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='CSS/adminDash.css') }}">
    <script src="{{ url_for('static', filename='JS/script.js') }}"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mount Table - Inventory Management</title>
</head>

<body>
    <nav>
        <div class="nav-container">
            <a href="{{ url_for('adminDash') }}" class="logo">Mount Table Admin</a>
            <ul class="nav-menu" id="navMenu">
                <li><a href="{{ url_for('adminDash') }}">Dashboard</a></li>
                <li><a href="{{ url_for('inventory_management') }}">Inventory</a></li>
                <li class="dropdown">
                    <a href="#">More</a>
                    <div class="dropdown-content">
                        <a href="{{ url_for('index') }}">Back to Home</a>
                        <a href="{{ url_for('logout') }}">Logout</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container container-wide">
        <header>
            <h1>Inventory Management - Mount Table</h1>
        </header>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="flash {{ category }}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <!-- Inventory Table -->
        <h2>Food Inventory Stock Management</h2>
        <p class="info-text">Enter a value and use the +/- buttons to adjust stock quantities by that amount. Changes
            are saved immediately.</p>

        <div class="table-responsive">
            {% if inventory_items %}
            <table class="admin-table" id="inventoryTable">
                <thead>
                    <tr>
                        <th>Item Name</th>
                        <th>Category</th>
                        <th>Current Stock</th>
                        <th>Weight</th>
                        <th>Stock Status</th>
                        <th>Last Updated</th>
                        <th>Adjust By</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in inventory_items %}
                    <tr>
                        <td>{{ item.item_name }}</td>
                        <td>{{ item.category }}</td>
                        <td><strong style="font-size: 18px;">{{ item.quantity }}</strong></td>
                        <td>{{ item.weight if item.weight else '-' }}</td>
                        <td>
                            {% if item.quantity < 15 %} <span class="status-badge status-low">Critical</span>
                                {% elif item.quantity < 30 %} <span class="status-badge status-medium">Low</span>
                                    {% elif item.quantity < 50 %} <span class="status-badge status-good">Moderate</span>
                                        {% else %}
                                        <span class="status-badge" style="background-color: #28a745;">Good</span>
                                        {% endif %}
                        </td>
                        <td>{{ item.last_updated.strftime('%Y-%m-%d') }}</td>
                        <td>
                            <input type="number" id="adjust-{{ item.item_id }}" value="1" min="1"
                                style="width: 60px; padding: 5px; text-align: center; border: 1px solid #ddd; border-radius: 3px;">
                        </td>
                        <td>
                            <div class="action-buttons" style="display: flex; gap: 5px; justify-content: center;">
                                <form method="POST"
                                    action="{{ url_for('update_stock', item_id=item.item_id, action='decrease') }}"
                                    style="display: inline;" id="form-decrease-{{ item.item_id }}">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                                    <input type="hidden" name="amount" id="amount-decrease-{{ item.item_id }}"
                                        value="1">
                                    <button type="button" class="button btn-small btn-danger decrease-btn"
                                        data-item-id="{{ item.item_id }}" data-current-stock="{{ item.quantity }}"
                                        style="padding: 5px 12px; font-size: 18px;">−</button>
                                </form>
                                <form method="POST"
                                    action="{{ url_for('update_stock', item_id=item.item_id, action='increase') }}"
                                    style="display: inline;" id="form-increase-{{ item.item_id }}">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                                    <input type="hidden" name="amount" id="amount-increase-{{ item.item_id }}"
                                        value="1">
                                    <button type="button" class="button btn-small btn-success increase-btn"
                                        data-item-id="{{ item.item_id }}"
                                        style="padding: 5px 12px; font-size: 18px;">+</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="info-text">No inventory items found.</p>
            {% endif %}

            <!-- Summary Statistics -->
            <div class="stats-grid" style="margin-top: 30px;">
                <div class="stat-card">
                    <div class="stat-label">Total Items</div>
                    <div class="stat-number">{{ inventory_items|length }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Low Stock Items</div>
                    <div class="stat-number">{{ inventory_items|selectattr('quantity', 'lt', 30)|list|length }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Critical Stock Items</div>
                    <div class="stat-number">{{ inventory_items|selectattr('quantity', 'lt', 15)|list|length }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Out of Stock</div>
                    <div class="stat-number">{{ inventory_items|selectattr('quantity', 'eq', 0)|list|length }}</div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="copyright">
            © 2025 Mount Table. All rights reserved.
        </div>
    </footer>
</body>

</html>